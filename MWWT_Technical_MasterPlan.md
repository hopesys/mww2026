# **Technical Specification & Implementation Plan**

## **Project: Miss Wellness World Thailand 2025 (MWWT)**

**Date:** 2026-02-06

**Status:** Approved for Development

**Target Launch (Phase 1):** Before 23 Feb 2026

## **1\. บทสรุปผู้บริหาร (Executive Summary)**

โครงการพัฒนาเว็บไซต์ Miss Wellness World Thailand มีเป้าหมายเพื่อรองรับการรับสมัครผู้เข้าประกวด (Phase 1\) และระบบโหวตแบบ Real-time (Phase 2\) โดยเน้นความรวดเร็วในการพัฒนา (Speed to Market) ความสามารถในการรองรับผู้ใช้งานจำนวนมาก (Scalability) และความเสถียรของระบบ (Stability) โดยใช้สถาปัตยกรรมแบบ Serverless ทั้งหมด

## **2\. เครื่องมือและเทคโนโลยี (Tech Stack Strategy)**

เราเลือกใช้เครื่องมือที่ทันสมัยที่สุดเพื่อให้งานเสร็จไวและรองรับ Traffic สูงได้โดยระบบไม่ล่ม

| Component | Technology | Rationale (เหตุผลที่เลือก) |
| :---- | :---- | :---- |
| **Frontend Framework** | **Next.js 14+ (App Router)** | เป็นมาตรฐานใหม่ของ React โหลดเร็ว ทำ SEO ได้ดีเยี่ยม (สำคัญสำหรับงานประกวด) |
| **Styling** | **Tailwind CSS** | พัฒนา UI ได้รวดเร็ว ปรับแต่ง CI/CD (สีเขียว/ทอง) ได้ง่าย และรองรับมือถือ (Responsive) สมบูรณ์แบบ |
| **Backend & Database** | **Supabase** | รวม Database (PostgreSQL), Authentication, และ Storage ไว้ที่เดียว ไม่ต้องเสียเวลา Setup Server เอง |
| **File Storage** | **Supabase Storage** | ใช้เก็บรูปภาพผู้สมัครและสลิปการโอนเงิน รองรับไฟล์ขนาดใหญ่และเข้าถึงได้รวดเร็ว |
| **Hosting / Deployment** | **Vercel** | รองรับ Next.js ได้ดีที่สุด มีระบบ Auto-scaling (รองรับคน 1,000+ คนได้ทันที) และ Deploy ง่ายมาก |
| **Payment Gateway** | **Omise (Opn Payments)** | รองรับ PromptPay QR และบัตรเครดิต ตัดเงินอัตโนมัติ เหมาะกับผู้ใช้งานคนไทย |
| **Email Service** | **Resend** | ส่งอีเมลยืนยันการสมัครพร้อมแนบ PDF เข้า Inbox ได้อย่างน่าเชื่อถือ (ไม่ตก Junk) |
| **PDF Generation** | **@react-pdf/renderer** | สร้างไฟล์ PDF ใบสมัครสวยงามด้วย React Component เพื่อส่งให้ผู้สมัครและกรรมการ |
| **UI Components** | **shadcn/ui (Tailwind v4)** | คอมโพเนนต์แบบ copy-paste (Button, Input, Label, Card) ใช้ธีม Neutral + สี Wellness (เขียว/ทอง) |

### โครงสร้างโปรเจกต์ (Next.js 16 App Router)

- **Route groups:** `app/(marketing)/` สำหรับหน้าแรก (layout ร่วม Header/Footer/BackToTop), `app/apply/`, `app/admin/`
- **Layouts:** แต่ละกลุ่มมี `layout.tsx` สำหรับ metadata และ wrapper
- **Components:** `components/layout/` (Header, Footer, Section, BackToTop), `components/ui/` (shadcn: button, input, label, card), `components/about/`, `components/halloffame/`, `components/application/`, `components/admin/`, `components/pdf/`
- **เพิ่มคอมโพเนนต์ shadcn:** `npx shadcn@canary add <ชื่อ>` (ใช้ canary สำหรับ Tailwind v4)

## **3\. สถาปัตยกรรมระบบ (System Architecture)**

### **Phase 1: ระบบรับสมัคร (Registration System)**

*Launch Date: กุมภาพันธ์*

1. **User Input:** ผู้สมัครกรอกฟอร์ม \+ อัปโหลดรูป (ครึ่งตัว/เต็มตัว) \+ อัปโหลดสลิป  
2. **Storage:** ไฟล์ถูกส่งตรงไปเก็บที่ **Supabase Storage** (Bucket: mwwt-uploads) ได้ URL กลับมา  
3. **Database:** ข้อมูล Text \+ URL รูปภาพ ถูกบันทึกลง **Supabase Database** (Table: applicants)  
4. **Notification:** ระบบส่งอีเมลยืนยันการสมัคร (ผ่าน Resend) พร้อมแนบ PDF ใบสมัคร

### **Phase 2: ระบบโหวต (Voting System)**

*Launch Date: มีนาคม \- เมษายน*

1. **Top-up:** ผู้ใช้งานเติมเงินซื้อ "Vote Credits" ผ่าน Omise (QR Code/Credit Card)  
2. **Vote:** ผู้ใช้งานกดโหวต \> ระบบหัก Credit \> เพิ่มคะแนนให้นางงาม  
3. **Real-time Display:** ใช้ **Supabase Realtime** แสดง Leaderboard สดๆ บนหน้าเว็บโดยไม่ต้อง Refresh

## **4\. โครงสร้างฐานข้อมูล (Database Schema)**

ออกแบบให้รองรับทั้งระบบสมัครและระบบโหวตในอนาคต

\-- 1\. ตารางผู้สมัคร (เก็บข้อมูลนางงาม)  
create table applicants (  
  id bigint generated by default as identity primary key,  
  created\_at timestamptz default now(),  

  \-- ข้อมูลส่วนตัว  
  first\_name text not null,  
  last\_name text not null,  
  nickname text,  
  age int,  
  height int,  
  weight int,  
  proportions text, \-- สัดส่วน  

  \-- ข้อมูลติดต่อ  
  phone text,  
  email text,  
  line\_id text,  

  \-- Media (URL จาก Storage)  
  photo\_half\_url text,  
  photo\_full\_url text,  
  video\_url text,  

  \-- สถานะและการเงิน  
  status text default 'pending\_payment', \-- pending, paid, approved  
  payment\_slip\_url text,  

  \-- ระบบโหวต  
  vote\_count int default 0  
);

\-- 2\. ตารางผู้ใช้งานทั่วไป (คนโหวต)  
create table users (  
  id uuid references auth.users not null primary key,  
  email text,  
  full\_name text,  
  vote\_credits int default 0, \-- แต้มคงเหลือ  
  created\_at timestamptz default now()  
);

\-- 3\. ตารางธุรกรรมการเงิน (ประวัติการจ่ายเงิน)  
create table transactions (  
  id uuid default uuid\_generate\_v4() primary key,  
  user\_id uuid references users(id), \-- กรณีคนโหวต  
  applicant\_id bigint references applicants(id), \-- กรณีจ่ายค่าสมัคร  
  amount decimal(10,2) not null,  
  payment\_type text, \-- 'registration\_fee', 'vote\_package'  
  status text, \-- 'pending', 'successful', 'failed'  
  omise\_charge\_id text, \-- เก็บ ID จาก Omise เพื่อตรวจสอบ  
  created\_at timestamptz default now()  
);

## **5\. แผนสำรองฉุกเฉิน (Contingency Plan) สำหรับ 23 ก.พ.**

เนื่องจากกระบวนการขออนุมัติ Payment Gateway (Omise) อาจใช้เวลา 7-14 วันทำการ หากไม่ทันกำหนดการเปิดรับสมัคร ให้ใช้แผนดังนี้:

* **Payment Method:** ปิดระบบตัดเงินอัตโนมัติชั่วคราว  
* **Fallback Action:** ใช้ระบบ **"แนบสลิปโอนเงิน" (Manual Bank Transfer)**  
  * แสดงเลขบัญชีหน้าเว็บ  
  * ให้ผู้สมัครโอนเงินผ่านแอปธนาคาร  
  * อัปโหลดรูปสลิปเข้ามาในฟอร์ม  
  * Admin ตรวจสอบยอดเงินจาก Dashboard หลังบ้านแล้วกด Approve  
* **ผลกระทบ:** Admin ต้องทำงานเพิ่มขึ้น (ตรวจสลิป) แต่ระบบจะเปิดได้ทันเวลา 100%

## **6\. Action Plan (สิ่งที่ต้องทำทันที)**

1. **Setup Environment:**  
   * สร้างโปรเจกต์ Next.js บน GitHub  
   * สร้างโปรเจกต์ Supabase และรัน SQL Script ด้านบน  
   * เชื่อมต่อ Vercel กับ GitHub  
2. **Develop Phase 1 (Registration):**  
   * สร้างหน้า Form รับสมัคร (UI Theme: เขียว/ทอง)  
   * เชื่อมต่อระบบอัปโหลดรูปภาพ (Supabase Storage)  
   * เขียน Logic บันทึกข้อมูลลง Database  
3. **PDF & Email:**  
   * ใช้ @react-pdf/renderer สร้าง Template ใบสมัคร  
   * เชื่อมต่อ Resend API เพื่อส่งเมล  
4. **Admin Dashboard (Simple Version):**  
   * สร้างหน้าตารางง่ายๆ ให้ทีมงาน Login เข้าไปดูรายชื่อและตรวจสลิป  
5. **Deployment:**  
   * Deploy ขึ้น Vercel และทดสอบระบบ

## **7\. ค่าใช้จ่ายโดยประมาณ (Estimated Cost)**

| Service | Plan | Cost |
| :---- | :---- | :---- |
| **Vercel** | Hobby (Phase 1\) \-\> Pro (Phase 2\) | ฟรี (ช่วงแรก) \-\> $20/เดือน (ช่วงโหวต) |
| **Supabase** | Free Tier (Phase 1\) \-\> Pro (Phase 2\) | ฟรี (ช่วงแรก) \-\> $25/เดือน (หาก Traffic สูง) |
| **Omise** | Standard | ไม่มีค่ารายเดือน (เสียค่าธรรมเนียมต่อรายการ \~3.65%) |
| **Resend** | Free Tier | ฟรี (ส่งได้ 3,000 ฉบับ/เดือน) |
| **Domain** | .com | (ลูกค้ามีแล้ว) |

**สรุป:** ค่าใช้จ่ายเริ่มต้นแทบจะเป็น **0 บาท** จะเริ่มเสียค่าใช้จ่ายจริงจังเมื่อเริ่มมีรายได้จากการโหวตหรือเมื่อ Traffic สูงมากเท่านั้น

## **8\. Security & Optimization (เพิ่มเติม)**

### **8.1 Input Validation (Zod)**

ใช้ **Zod** สำหรับ validate ข้อมูลฟอร์มทั้ง Client และ Server:

```typescript
// src/schemas/applicant.ts
import { z } from 'zod';

export const applicantSchema = z.object({
  first_name: z.string().min(1, 'กรุณากรอกชื่อ').max(100),
  last_name: z.string().min(1, 'กรุณากรอกนามสกุล').max(100),
  nickname: z.string().max(50).optional(),
  age: z.coerce.number().min(18, 'ต้องอายุ 18 ปีขึ้นไป').max(40),
  height: z.coerce.number().min(150).max(200),
  weight: z.coerce.number().min(40).max(100),
  phone: z.string().regex(/^0[0-9]{9}$/, 'เบอร์โทรไม่ถูกต้อง'),
  email: z.string().email('อีเมลไม่ถูกต้อง'),
  line_id: z.string().min(1).max(50).optional(),
});
```

### **8.2 Row Level Security (RLS)**

```sql
-- เปิด RLS
ALTER TABLE applicants ENABLE ROW LEVEL SECURITY;

-- ผู้สมัคร (anon) สามารถ INSERT เท่านั้น
CREATE POLICY "Allow public insert" ON applicants
  FOR INSERT TO anon WITH CHECK (true);

-- Admin เท่านั้นที่อ่านได้
CREATE POLICY "Admin read only" ON applicants
  FOR SELECT TO authenticated
  USING (auth.jwt() ->> 'role' = 'admin');
```

### **8.3 Safe Voting Transaction (RPC)**

ใช้ Postgres Function เพื่อป้องกัน Race Condition และ Double Spending:

```sql
CREATE OR REPLACE FUNCTION vote_for_applicant(
  p_user_id UUID,
  p_applicant_id BIGINT,
  p_amount INT
)
RETURNS JSONB
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  v_current_credits INT;
BEGIN
  -- Lock row เพื่อป้องกัน race condition
  SELECT vote_credits INTO v_current_credits
  FROM users WHERE id = p_user_id FOR UPDATE;
  
  IF v_current_credits < p_amount THEN
    RETURN jsonb_build_object('success', false, 'error', 'ไม่มี credit เพียงพอ');
  END IF;
  
  -- หัก credit
  UPDATE users SET vote_credits = vote_credits - p_amount WHERE id = p_user_id;
  
  -- เพิ่มคะแนน
  UPDATE applicants SET vote_count = vote_count + p_amount WHERE id = p_applicant_id;
  
  -- Log transaction
  INSERT INTO transactions (user_id, applicant_id, amount, payment_type, status)
  VALUES (p_user_id, p_applicant_id, p_amount, 'vote', 'successful');
  
  RETURN jsonb_build_object('success', true, 'remaining_credits', v_current_credits - p_amount);
END;
$$;
```

### **8.4 Client-Side Image Compression**

```bash
npm install browser-image-compression
```

```javascript
import imageCompression from 'browser-image-compression';

async function compressAndUpload(file) {
  const options = {
    maxSizeMB: 1,
    maxWidthOrHeight: 1920,
    useWebWorker: true,
  };
  const compressedFile = await imageCompression(file, options);
  // Upload to Supabase Storage
}
```

### **8.5 Payment Security**

* **Omise Webhook**: ตรวจสอบ Signature ทุกครั้งก่อน process payment
* **Idempotency Key**: ป้องกัน double-charge จาก network retry